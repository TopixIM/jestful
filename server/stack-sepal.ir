{:definitions {"jestful.main/render-loop!" ["defn" "render-loop!" [] ["if" ["not=" "@reader-db-ref" "@writer-db-ref"] ["do" ["reset!" "reader-db-ref" "@writer-db-ref"] ["--" "println" "|render loop"] ["render-clients!" "@reader-db-ref" "render-scene" "render-view"]]] ["js/setTimeout" "render-loop!" "300"]], "jestful.main/on-jsload" ["defn" "on-jsload" [] ["println" "|code updated."] ["render-clients!" "@reader-db-ref" "render-scene" "render-view"]], "jestful.main/writer-db-ref" ["defonce" "writer-db-ref" ["atom" "schema/database"]], "jestful.main/reader-db-ref" ["defonce" "reader-db-ref" ["atom" "@writer-db-ref"]], "jestful.view/render-scene" ["defn" "render-scene" ["db"] "db"], "jestful.updater.core/handle-naming" ["defn" "handle-naming" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc-in" "db" ["[]" ":states" "state-id" ":nickname"] "op-data"]], "jestful.updater.state/connect" ["defn" "connect" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc-in" "db" ["[]" ":states" "state-id"] ["merge" "schema/state" ["{}" [":id" "state-id"]]]]], "jestful.schema/state" ["def" "state" ["{}" [":user-id" "nil"] [":id" "nil"] [":nickname" "|"] [":draft" "|"]]], "jestful.updater.core/handle-draft" ["defn" "handle-draft" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc-in" "db" ["[]" ":states" "state-id" ":draft"] "op-data"]], "jestful.view/render-view" ["defn" "render-view" ["state-id" "db"] ["{}" [":state" ["get-in" "db" ["[]" ":states" "state-id"]]] [":messages" [":messages" "db"]] [":statistics" ["{}" [":count" ["count" [":states" "db"]]] [":names" ["map" ["fn" ["entry"] ["let" [["state" ["last" "entry"]] ["nickname" [":nickname" "state"]]] ["if" ["string/blank?" "nickname"] "|шо┐хов" "nickname"]]] [":states" "db"]]]]] [":drafts" ["->>" [":states" "db"] ["map" "val"] ["filter" ["fn" ["state"] ["not" ["string/blank?" [":draft" "state"]]]]] ["map" ["fn" ["state"] ["let" [["draft" [":draft" "state"]] ["nickname" [":nickname" "state"]]] ["[]" "state-id" "nickname" "draft"]]]]]]]], "jestful.updater.core/handle-reply" ["defn" "handle-reply" ["db" "op-data" "state-id" "op-id" "op-time"] ["let" [["state" ["get-in" "db" ["[]" ":states" "state-id"]]] ["nickname" [":nickname" "state"]]] ["->" "db" ["update" ":messages" ["fn" ["messages"] ["let" [["left-messages" ["if" [">" ["count" "messages"] "40"] ["subvec" "messages" "10"] "messages"]]] ["conj" "messages" ["{}" [":id" "op-id"] [":text" "op-data"] [":author-name" "nickname"] [":time" "op-time"]]]]]] ["assoc-in" ["[]" ":states" "state-id" ":draft"] "|"]]]], "jestful.schema/message" ["def" "message" ["{}" [":id" "nil"] [":text" "|"] [":autho-name" "|"] [":time" "nil"]]], "jestful.updater.core/updater" ["defn" "updater" ["db" "op" "op-data" "state-id" "op-id" "op-time"] ["case" "op" [":state/connect" ["state/connect" "db" "op-data" "state-id" "op-id" "op-time"]] [":state/disconnect" ["state/disconnect" "db" "op-data" "state-id" "op-id" "op-time"]] [":reply" ["handle-reply" "db" "op-data" "state-id" "op-id" "op-time"]] [":naming" ["handle-naming" "db" "op-data" "state-id" "op-id" "op-time"]] [":draft" ["handle-draft" "db" "op-data" "state-id" "op-id" "op-time"]] "db"]], "jestful.main/-main" ["defn" "-main" [] ["nodejs/enable-util-print!"] ["let" [["server-ch" ["run-server!" ["{}" ":port" "5020"]]]] ["go-loop" ["[]"] ["let" [[["[]" "op" "op-data" "state-id" "op-id" "op-time"] ["<!" "server-ch"]] ["new-db" ["updater" "@writer-db-ref" "op" "op-data" "state-id" "op-id" "op-time"]]] ["println" "|event" "op" "op-data" "state-id" "op-id" "op-time"] ["reset!" "writer-db-ref" "new-db"] ["recur"]]] ["render-loop!"]] ["add-watch" "reader-db-ref" ":log" ["fn" []]] ["println" "|server started"]], "jestful.updater.state/disconnect" ["defn" "disconnect" ["db" "op-data" "state-id" "op-id" "op-time"] ["update" "db" ":states" ["fn" ["state"] ["dissoc" "state" "state-id"]]]], "jestful.schema/database" ["def" "database" ["{}" [":states" ["{}"]] [":users" ["{}"]] [":messages" ["[]"]]]]}, :namespaces {"jestful.main" ["ns" "jestful.main" [":require" ["[]" "cljs.nodejs" ":as" "nodejs"] ["[]" "jestful.schema" ":as" "schema"] ["[]" "cumulo-server.core" ":refer" ["[]" "run-server!" "render-clients!"]] ["[]" "jestful.updater.core" ":refer" ["[]" "updater"]] ["[]" "jestful.view" ":refer" ["[]" "render-view" "render-scene"]] ["[]" "cljs.core.async" ":refer" ["[]" "<!"]]] [":require-macros" ["[]" "cljs.core.async.macros" ":refer" ["[]" "go-loop"]]]], "jestful.schema" ["ns" "jestful.schema"], "jestful.updater.core" ["ns" "jestful.updater.core" [":require" ["[]" "jestful.updater.state" ":as" "state"]]], "jestful.updater.state" ["ns" "jestful.updater.state" [":require" ["[]" "jestful.schema" ":as" "schema"]]], "jestful.view" ["ns" "jestful.view" [":require" ["[]" "jestful.schema" ":as" "schema"] ["[]" "clojure.string" ":as" "string"]]]}, :main-definition nil, :procedures {"jestful.main" [["set!" "*main-cli-fn*" "-main"]], "jestful.schema" [], "jestful.updater.core" [], "jestful.updater.state" [], "jestful.view" []}}